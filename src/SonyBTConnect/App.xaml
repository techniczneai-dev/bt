<Application x:Class="SonyBTConnect.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:SonyBTConnect"
             xmlns:tb="clr-namespace:H.NotifyIcon;assembly=H.NotifyIcon.Wpf"
             ShutdownMode="OnExplicitShutdown">

    <Application.Resources>
        <!-- Konwertery - musza byc przed uzyciem -->
        <local:InverseBooleanConverter x:Key="InverseBoolConverter" />

        <!-- Menu kontekstowe -->
        <ContextMenu x:Key="TrayMenu">
            <MenuItem Header="Connect headphones"
                      Command="{Binding ConnectCommand}"
                      IsEnabled="{Binding IsConnecting, Converter={StaticResource InverseBoolConverter}}" />
            <Separator />
            <MenuItem Header="Start with Windows"
                      IsCheckable="True"
                      IsChecked="{Binding IsAutoStartEnabled, Mode=TwoWay}" />
            <Separator />
            <MenuItem Header="Exit"
                      Command="{Binding ExitCommand}" />
        </ContextMenu>

        <!-- TaskbarIcon -->
        <tb:TaskbarIcon x:Key="TrayIcon"
                        ToolTipText="{Binding TooltipText}"
                        ContextMenu="{StaticResource TrayMenu}"
                        LeftClickCommand="{Binding ConnectCommand}"
                        MenuActivation="RightClick">

            <!-- Dynamiczna ikona oparta na stanie polaczenia -->
            <tb:TaskbarIcon.IconSource>
                <tb:GeneratedIconSource
                    Text="BT"
                    Foreground="{Binding IconForeground}"
                    Background="{Binding IconBackground}"
                    FontSize="20"
                    FontFamily="Segoe UI"
                    FontWeight="Bold" />
            </tb:TaskbarIcon.IconSource>

        </tb:TaskbarIcon>
    </Application.Resources>
</Application>
